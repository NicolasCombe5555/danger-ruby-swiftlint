# frozen_string_literal: true

require_relative '../../lib/version'

namespace :swiftlint do
  desc 'Download and install swiftlint tool'
  task :install do
    next if ENV['DANGER_SKIP_SWIFTLINT_INSTALL'] == 'YES'

    REPO = 'https://github.com/realm/SwiftLint'
    VERSION = ENV['SWIFTLINT_VERSION'] || DangerSwiftlint::SWIFTLINT_VERSION
    ASSET = 'portable_swiftlint.zip'
    ENV['ASSET'] = ASSET
    ENV['URL'] = "#{REPO}/releases/download/#{VERSION}/#{ASSET}"
    ENV['SWIFTLINT_MD5_HASH'] = DangerSwiftlint::SWIFTLINT_HASH
    ENV['DESTINATION'] = File.expand_path(File.join(File.dirname(__FILE__), 'bin'))

    puts "Downloading swiftlint@#{VERSION}"
    sh "./downloadSwiftlint.sh"
  end
end

task default: 'swiftlint:install'
